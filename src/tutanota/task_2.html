<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
          name="viewport">
    <title>Tutanota task 2</title>

    <!-- Libraries -->
    <script src="https://unpkg.com/tailwindcss-jit-cdn@1.3.0"></script>
    <script src="https://unpkg.com/lodash@4.17.21"></script>
    <script src="https://unpkg.com/string-similarity@4.0.4/umd/string-similarity.min.js"></script>
</head>
<body>
<main class="h-screen grid place-items-center bg-gray-50">

    <form id="email-form">

        <label class="block font-medium text-gray-700" for="email-input">
            Is this email spam?
        </label>

        <div class="mt-1 rounded-md shadow-sm">

            <textarea
                    aria-describedby="email-input-message"
                    class="block w-full border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                    cols="30"
                    id="email-input"
                    name="email-input"
                    rows="10"
            ></textarea>
        </div>

        <button class="mt-2 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                type="submit">
            Calculate probability
        </button>

        <p class="mt-2 text-md invisible" id="email-input-message">
            Example message.
        </p>
    </form>

</main>

<script>
	'use strict'

	const EMAIL_FORM_SELECTOR = 'email-form'
	const EMAIL_INPUT_SELECTOR = 'email-input'
	const EMAIL_INPUT_MESSAGE_SELECTOR = 'email-input-message'

	document.addEventListener('DOMContentLoaded', function () {

		document.getElementById(EMAIL_FORM_SELECTOR)
			.addEventListener('submit', onEmailFormSubmit, true)
	})

	function onEmailFormSubmit(event) {
		event.preventDefault()

		document.getElementById(EMAIL_INPUT_MESSAGE_SELECTOR).classList.add('invisible');

		const EMAIL_INPUT_ELEMENT = document.getElementById(EMAIL_INPUT_SELECTOR)

		const SPAM_PROBABILITY = calculateSpamProbability(EMAIL_INPUT_ELEMENT.value)

		showEmailMessage(`Spam probability: ${ SPAM_PROBABILITY }%`)
	}

	// Gather list of known spam emails from a fake API
	function getSpamEmails() {
		return [
			"Dear Lucky Winner, \n CONGRATULATIONS: This is to inform you that your email address emerged as a Winner of an amount of US$1,500,000.00 Dollars, (One Million Five Hundred Thousand United States Dollars) in the QATAR FIFA WORLD CUP 2022 GAME PROMOTION Draw held in Istanbul Turkey through an open Computer ballot JAVA System. This Promotional Lottery Draws sponsored by the Hisense, Microsoft and the World Health Organization (WHO) in Collaboration with the Center for Disease Control (CDC) to help provide financial assistance to families across the globe while working hard with so many nations to combat this world Coronavirus pandemic and also to support the coming QATAR FIFA WORLD CUP 2022 GAME.		All participantsÂ’ email was automatically entered in the draw as Microsoft collected all the Active email users globally for this promotion. Your email Address attached to Reference Number: WCD80010011 was luckily drawn to win you the prize in the category ''A''. Therefore a Pin Number has been issued for you to claim your prize. Pin code: 00357721.\n For you to receive your US$1,500,000.00 Dollars (One Million Five Hundred Thousand United States Dollars). You are advised to contact our European claim agents as stated below. After he finishes processing your Payment file, he will forward it to the appointed payment bank, Then the bank will contact you for urgent transfer of your fund to any of your nominated bank account, OR the bank will Issue you an International ATM VISA CARD, which you can use to withdraw your fund from any ATM Machine in your country or anywhere in the World.\n CLAIM OFFICE ISTANBUL TURKEY.\n	Contact Agent: Mr. John Gibson\n Contact E-mail: agentjohngibson@gmail.com\n Phone/WhatsApp: +905385150430\n Forward the following information as stated below to them.\n	1. Full Name: \n 2. Address: \n 3. Age: \n 		\n 4. Occupation: \n 5. Mobile Number: \n 6. REFERENCE NUMBER: WCD80010011             \n Send the above information to submit your claim. You should only contact the above mentioned agent (Mr. John Gibson ) who shall direct you on how to receive your prize money. Please keep your winning Identification Numbers confidential to avoid double claims. \n \n Yours Truthfully,\n Mr. Paul Brown \n WINNING NOTIFICATION OFFICER",
			"Hello dear, nice to meet you here.\n \n My name is Miss. Elhamsadat Kamizi, The daughter of Late  Kamizi Seyed\n Hossein from Iran I sincerely do not wish to inconvenience you with my\n letter, I have a Project proposal I wish to discuss with you about the\n total amount of $7.5 Million Dollars (Seven million and Five Hundred\n Thousand USD Only)  I would need your assistance to invest the money under\n your care.\n \n I came across your email, while I was researching for reliable property\n management in Google and I saw your contact and my spirit directed me to\n contact you for a partnership over Charity Home or any kind of a structure\n that will create job opportunities for the Underprivileged that was my\n dreams project in the memory of my late parents Mr/Mrs Kamizi Seyedhossein\n across the country.\n \n For your assistance I have agreed to offer you 30% of the whole fund while\n 10% will be for any experience that may be incurred the remaining 60% will\n be used on the Underprivileged Project If you are willing to help me to\n achieve this my dream about the project , please kindly get back to me for\n more details.\n \n Best Regards\n Miss. Elhamsadat Kamizi",
			"I came across your e-mail contact prior to a private search while in need of your assistance. I am Mrs. Rula Ghani, I have investment funds worth Twenty Two Million United State Dollar ($22,000,000.00 ) and i need a trusted investment Manager/Partner, however, I am interested in you for investment project assistance in your country, may be from there, we can build business relationship in the nearest future.\n \n I am willing to negotiate an investment/business profit sharing ratio with you based on the future investment earning profits.\n \n If you are willing to handle this project on my behalf kindly reply urgently to enable me to provide you more information about the investment funds.\n \n Best Regards \n Mrs. Rula Ghani"]
	}

	// Compare the email to a list of known spam emails and calculate a probability of it being spam.
	function calculateSpamProbability(email) {
		const SPAM_EMAIL_LIST = getSpamEmails()

		const SPAM_EMAIL_SIMILARITY_LIST = SPAM_EMAIL_LIST.map((spamEmail) => {
			const SIMILARITY_PERCENT = window.org_turbocommons.StringUtils.compareSimilarityPercent(email, spamEmail)

			return SIMILARITY_PERCENT
		})

		const SPAM_PROBABILITY = SPAM_EMAIL_SIMILARITY_LIST.reduce((previousValue, currentValue) => previousValue + currentValue, 0) / SPAM_EMAIL_SIMILARITY_LIST.length

		const SPAM_PROBABILITY_ROUNDED = Math.round(SPAM_PROBABILITY)

		return SPAM_PROBABILITY_ROUNDED
	}

	// Show the probability to the user
	function showEmailMessage(message) {
		const EMAIL_INPUT_MESSAGE_ELEMENT = document.getElementById(EMAIL_INPUT_MESSAGE_SELECTOR)

		EMAIL_INPUT_MESSAGE_ELEMENT.textContent = message

		EMAIL_INPUT_MESSAGE_ELEMENT.classList.remove('invisible')
	}
</script>
</body>
</html>
