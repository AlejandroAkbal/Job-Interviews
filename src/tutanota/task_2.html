<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
          name="viewport">
    <title>Tutanota task 2</title>

    <!-- Libraries -->
    <script src="https://unpkg.com/tailwindcss-jit-cdn@1.3.0"></script>
    <script src="https://unpkg.com/lodash@4.17.21"></script>
    <script src="https://cdn.jsdelivr.net/npm/turbocommons-es6@3.8.0/turbocommons-es6.js"></script>
</head>
<body>
<main class="h-screen grid place-items-center bg-gray-50">

    <form id="email-form">

        <label class="block font-medium text-gray-700" for="email-input">
            Is this email spam?
        </label>

        <div class="mt-1 rounded-md shadow-sm">

            <!-- Original SPAM message -->
            <textarea
                    aria-describedby="email-input-message"
                    class="block w-full border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                    cols="30"
                    id="email-input"
                    name="email-input"
                    rows="10"
            >Dear Lucky Winner,

CONGRATULATIONS: This is to inform you that your email address emerged as a Winner of an amount of US$1,500,000.00 Dollars, (One Million Five Hundred Thousand United States Dollars) in the QATAR FIFA WORLD CUP 2022 GAME PROMOTION Draw held in Istanbul Turkey through an open Computer ballot JAVA System. This Promotional Lottery Draws sponsored by the Hisense, Microsoft and the World Health Organization (WHO) in Collaboration with the Center for Disease Control (CDC) to help provide financial assistance to families across the globe while working hard with so many nations to combat this world Coronavirus pandemic and also to support the coming QATAR FIFA WORLD CUP 2022 GAME.

All participants’ email was automatically entered in the draw as Microsoft collected all the Active email users globally for this promotion. Your email Address attached to Reference Number: WCD80010011 was luckily drawn to win you the prize in the category ''A''. Therefore a Pin Number has been issued for you to claim your prize. Pin code: 00357721.

For you to receive your US$1,500,000.00 Dollars (One Million Five Hundred Thousand United States Dollars). You are advised to contact our European claim agents as stated below. After he finishes processing your Payment file, he will forward it to the appointed payment bank, Then the bank will contact you for urgent transfer of your fund to any of your nominated bank account, OR the bank will Issue you an International ATM VISA CARD, which you can use to withdraw your fund from any ATM Machine in your country or anywhere in the World.

CLAIM OFFICE ISTANBUL TURKEY.
Contact Agent: Mr. John Gibson
Contact E-mail: agentjohngibson@gmail.com
Phone/WhatsApp: +905385150430

Forward the following information as stated below to them.

1. Full Name:
2. Address:
3. Age:
4. Occupation:
5. Mobile Number:
6. REFERENCE NUMBER: WCD80010011

Send the above information to submit your claim. You should only contact the above mentioned agent (Mr. John Gibson ) who shall direct you on how to receive your prize money. Please keep your winning Identification Numbers confidential to avoid double claims.

Yours Truthfully,

Mr. Paul Brown
WINNING NOTIFICATION OFFICER</textarea>
        </div>

        <button class="mt-2 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                type="submit">
            Calculate probability
        </button>

        <p class="mt-2 text-md invisible" id="email-input-message">
            Example message.
        </p>
    </form>

</main>

<script>
	'use strict'

	const EMAIL_FORM_SELECTOR = 'email-form'
	const EMAIL_INPUT_SELECTOR = 'email-input'
	const EMAIL_INPUT_MESSAGE_SELECTOR = 'email-input-message'

	document.addEventListener('DOMContentLoaded', function () {

		document.getElementById(EMAIL_FORM_SELECTOR)
			.addEventListener('submit', onEmailFormSubmit, true)
	})

	function onEmailFormSubmit(event) {
		event.preventDefault()

		document.getElementById(EMAIL_INPUT_MESSAGE_SELECTOR).classList.add('invisible');

		const EMAIL_INPUT_ELEMENT = document.getElementById(EMAIL_INPUT_SELECTOR)

		const SPAM_PROBABILITY = calculateSpamProbability(EMAIL_INPUT_ELEMENT.value)

		showEmailMessage(`Spam probability: ${ SPAM_PROBABILITY }%`)
	}

	// Gather list of known spam emails from a fake API
	// These emails are similar to each other, as some words have been changed
	function getSpamEmails() {
		return [
			"Dear Lucky Winner, \n CONGRATULATIONS: This is to inform you that your email address emerged as a Winner of an amount of US$9,423,000.00 Dollars, in the FIFA WORLD CUP 2022 GAME PROMOTION Draw held in America through an open Computer ballot JAVA System. This Promotional Lottery Draws sponsored by the Hisense, Microsoft and the World Health in Collaboration with the Center for Disease Control (CDC) to help provide financial assistance to families across the globe while working hard with so many nations to combat this world Coronavirus epidemic and also to support the coming QATAR FIFA WORLD CUP 2022 GAME.		All participants email was automatically entered in the draw as Microsoft collected all the email users globally for this promotion. Your email Address attached to Reference Number: WCD80010011 was luckily drawn to win you the prize in the category ''B''. Therefore a Pin Number has been issued for you to claim your prize. Pin code: 00357721.\n For you to receive your US$1,500,000.00 Dollars. You are advised to contact our European claim agents as stated below. After he finishes processing your Payment file, they will forward it to the appointed payment bank, Then the bank will contact you for urgent transfer of your money to any of your nominated bank account, OR the bank will Issue you an International ATM Mastercard CARD, which you can use to withdraw your fund from any ATM Machine in your country or anywhere in the World.\n CLAIM OFFICE ISTANBUL TURKEY.\n	Contact Agent: Mr. John Gibson\n Contact E-mail: agentjohngibson@gmail.com\n Phone: +905385150430\n Forward the following information as stated below to them.\n	1. Name: \n 2. Address: \n 3. Age: \n 		\n 4. Occupation: \n 5. Mobile Number: \n 6. REFERENCE NUMBER: WCD80010011             \n Send the above information to submit your claim. You should only contact the above mentioned agent who shall direct you on how to receive your money. Please keep your winning Identification Numbers confidential to avoid claims. \n \n Yours Truthfully,\n Mr. Brown \n WINNING NOTIFICATION OFFICER",
			"Dear Winner, \n CONGRATULATIONS: This is to inform you that your email emerged as a Winner of the amount of US$1,500,234.00 Euros, in the QATAR FOFA WORLD CUP 2022 GAME Draw held in Istanbul Spain through an open Computer ballot JAVA System. This Promotional Lottery Draws sponsored by the Hisense, Tutanota and the World Health Organization (WHO) in Collaboration with the Center for Disease Control (CDC) to help provide financial assistance to families across the globe while working easily with so many nations to combat this world Coronavirus pandemic and also to support the coming QATAR FIFA WORLD CUP 2022 GAME.		All participants email was automatically entered in the draw as Microsoft collected all the Active email users globally for this promotion. Your email Address attached to Reference Number: WCD80010011 was luckily drawn to win you the prize in the category ''A''. Therefore a Pin Number has been issued for you to claim your prize. Pin code: 00357721.\n For you to receive your US$1,500,000.00 Dollars. You are advised to contact our Spanish claim agents as stated below. After he finishes processing your Payment, he will send it to the appointed payment bank, Then the bank will contact you for urgent transfer of your fund to any of your nominated account, OR the bank will Issue you an International VISA CARD, which you can use to withdraw your fund from any ATM Machine in your city or anywhere in the World.\n CLAIM OFFICE DISNEYLAND TURKEY.\n	Contact Agent: Mr. John French\n Contact E-mail: aaaa@gmail.com\n Phone/WhatsApp: +498347845\n Forward the following information as stated below to them.\n	1. Full Name: \n 2. Address: \n 3. Age: \n 		\n 4. Occupation: \n 5. Mobile Number: \n 6. REFERENCE NUMBER: WCDfsfesef            \n Send the information to submit your claim. You should only contact the above mentioned agent who shall tell you on how to receive your prize money. Please keep your winning ID Numbers confidential to avoid double claims. \n \n Yours Truthfully,\n Mr. Paul \n WINNING NOTIFICATION OFFICER",
			"Dear Juan, \n CONGRATULATIONS: We inform you that your email address emerged as a Winner of an amount of US$700,000.00 Dollars, in the QATAR FIFA CUP 2022 GAME PROMOTION Draw held in Istanbul Turkey through an open Computer ballot System. This Promotional Lottery Draws sponsored by the Hisense, Microsoft and the World Health Organization (WHO) in Collaboration with the Center for Disease Control (CDC) to help provide financial assistance to families across the globe while working hard with so many nations to combat this world Coronavirus pandemic and also to support the coming QATAR FIFA WORLD CUP 2022 GAME.		All participants email was automatically entered in the draw as Microsoft collected all the Active email users globally for this promotion. Your email attached to Reference Number: WCD8001001134434 was luckily drawn to win you the prize in the category ''A''. Therefore a Pin Number has been issued for you to claim your prize. Pin code: 00357721.\n For you to receive your US$1,500,000.00 Dollars. You are advised to contact our French claim agents. After he finishes processing your Payment file, he will forward it to the appointed payment bank, Then the bank will contact you for a fast transfer of your fund to any of your nominated bank account, OR the bank will issue you an International ATM VISA CARD, which you can use to withdraw your fund from any ATM Machine in your country or anywhere.\n CLAIM OFFICE ISTANBUL TURKEY.\n	Contact Agent: Mr. John Gibson\n Contact E-mail: agentjohngibson@gmail.com\n Phone/WhatsApp: +905382322325150430\n Forward the following information as stated below to them.\n	1. Full Name: \n 2. Address: \n 3. Age: \n 		\n 4. Occupation: \n 5. Mobile: \n 6. REFERENCE NUMBER: WCD80010011             \n Send the above info to submit your claim. You should only contact the above mentioned agent who shall direct you on how to receive your prize. Please keep your winning Numbers confidential to avoid double claims. \n \n Yours Truthfully,\n Mr. French guy \n WINNING NOTIFICATION OFFICER",
		]
	}

	// Compare the email to a list of known spam emails and calculate a probability of it being spam.
	function calculateSpamProbability(email) {
		const SPAM_EMAIL_LIST = getSpamEmails()

		const SPAM_EMAIL_SIMILARITY_LIST = SPAM_EMAIL_LIST.map((spamEmail) => {
			const SIMILARITY_PERCENT = window.org_turbocommons.StringUtils.compareSimilarityPercent(email, spamEmail)

			return SIMILARITY_PERCENT
		})

		const SPAM_PROBABILITY = SPAM_EMAIL_SIMILARITY_LIST.reduce((previousValue, currentValue) => previousValue + currentValue, 0) / SPAM_EMAIL_SIMILARITY_LIST.length

		const SPAM_PROBABILITY_ROUNDED = Math.round(SPAM_PROBABILITY)

		return SPAM_PROBABILITY_ROUNDED
	}

	// Show the probability to the user
	function showEmailMessage(message) {
		const EMAIL_INPUT_MESSAGE_ELEMENT = document.getElementById(EMAIL_INPUT_MESSAGE_SELECTOR)

		EMAIL_INPUT_MESSAGE_ELEMENT.textContent = message

		EMAIL_INPUT_MESSAGE_ELEMENT.classList.remove('invisible')
	}
</script>
</body>
</html>
